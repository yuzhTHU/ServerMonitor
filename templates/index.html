<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIB-Lab 服务器性能监控 - Server Monitor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container" id="main">
        <div class="row">
        <div class="col-12"> 
            <h1 id="title">FIB-Lab 服务器性能监控</h1> 
        </div>
        </div>

        <div class="row">
        <div class="col-12"> 
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation"> 
                    <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab">
                        仪表盘
                    </button>
                </li>
                <li class="nav-item" role="presentation"> 
                    <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">
                        历史数据
                    </button>
                </li>
                <li class="nav-item" role="presentation"> 
                    <button class="nav-link" id="user-tab" data-bs-toggle="tab" data-bs-target="#user" type="button" role="tab">
                        用户数据
                    </button>
                </li>
                <li class="nav-item" role="presentation"> 
                    <button class="nav-link" id="disk-tab" data-bs-toggle="tab" data-bs-target="#disk" type="button" role="tab">
                        磁盘用量
                    </button>
                </li>
                <li class="nav-item" role="presentation"> 
                    <button class="nav-link" id="ports-tab" data-bs-toggle="tab" data-bs-target="#ports" type="button" role="tab">
                        开放端口
                    </button>
                </li>
                <li class="nav-item" role="presentation"> 
                    <button class="nav-link" id="iptable-tab" data-bs-toggle="tab" data-bs-target="#iptable" type="button" role="tab">
                        IP地址
                    </button>
                </li>
            </ul>
        </div>
        </div>

        <div class="row">
            <div class="tab-content col-12" id="myTabContent">
                <div class="tab-pane fade show active" id="dashboard" role="tabpanel"> </div>
                <div class="tab-pane fade" id="history" role="tabpanel"> </div>
                <div class="tab-pane fade" id="user" role="tabpanel"> </div>
                <div class="tab-pane fade" id="disk" role="tabpanel"> </div>
                <div class="tab-pane fade" id="ports" role="tabpanel"> </div>
                <div class="tab-pane fade" id="iptable" role="tabpanel"> </div>
            </div>
        </div>
    </div>

    <footer class="text-center mt-4 py-4 col-12" style="background-color: #f8f9fa;">
        <p>服务器监控系统 | <a href="https://github.com/yuzhTHU/ServerMonitor" target="_blank">GitHub 仓库</a></p>
        <p>&copy; 2024</p>
    </footer>    


    <!-- Dashboard -->
    <script src="https://colorjs.io/dist/color.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- History -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <!-- Disk -->
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <!-- Utils -->
    <script src="/js/utils.js"></script>
    <script src="/js/drag.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tabMap = {
                'dashboard': 'html/dashboard.html',
                'history': 'html/history.html',
                'user': 'html/user.html',
                'disk': 'html/disk.html',
                'ports': 'html/ports.html',
                'iptable': 'html/iptable.html'
            };
            
            function replaceScript(container) {
                // 将 container 中的 scripts 全部替换一遍，以此触发它们的执行
                const scripts = container.querySelectorAll('script');
                scripts.forEach(oldScript => {
                    const newScript = document.createElement('script');
                    if (oldScript.src) { newScript.src = oldScript.src; } 
                    else { newScript.textContent = oldScript.textContent; }
                    oldScript.parentNode.replaceChild(newScript, oldScript);
                });
            }

            function loadTabContent(tabId) {
                // 在首次切换到对应的选项卡时，加载选项卡中的内容
                const tabContent = tabMap[tabId];
                const container = document.getElementById(tabId);
                if (!tabContent || container.dataset.loaded) return;
                fetch(tabContent)
                    .then(res => res.text())
                    .then(html => {
                        container.innerHTML = html;
                        container.dataset.loaded = 'true';
                        replaceScript(container);
                    })
                    .catch(err => {
                        container.innerHTML = `<div class="text-danger p-3">加载失败：${err}</div>`;
                    });
            }
        
            // 默认加载 dashboard
            loadTabContent('dashboard');
        
            // 监听 tab 切换事件，首次切换时加载对应的 html
            document.querySelectorAll('button[data-bs-toggle="tab"]').forEach(btn => {
                btn.addEventListener('shown.bs.tab', function (e) {
                    const tabId = e.target.getAttribute('data-bs-target').substring(1);
                    loadTabContent(tabId);
                });
            });
        });
    </script>
        
</body>
</html>
